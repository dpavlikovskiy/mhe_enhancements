!function(a){function b(b,c){this.ele=b,this.options=a.extend({},{},c),this.isIE8=!!a(".ie8").length,this.parentPromo="blp"===this.options.template?this.ele.closest(".blp-sizes").find(".blp-sizes-show"):this.ele.closest(".plp-promo"),this.products=a(".products"),this.cnt=this.ele.find(".promo-shelf-sizes"),this.bottles=this.ele.find(".promo-shelf-bottle"),this.flute=this.ele.parent().find("#js-flute"),this.initBgPos=[],this.initBgWidth=300,this.initBgHeight=130,this.xOffset=parseInt(this.bottles.find("img").css("margin-left"),10),this.midElement=4,this.shelf=null,this.init()}b.prototype={setBgPos:function(a,b){var c=this.initBgWidth;b<this.initBgWidth/2&&(c=2*b),this.cnt.css({"background-position":a-c/2+this.xOffset/2+"px "+parseInt(this.initBgPos[1],10)+"px","background-size":c+"px "+this.initBgHeight+"px"})},closeShelf:function(){switch(this.shelf.css("max-height",0).removeClass("shelf-open"),this.options.template){case"plp":this.parentPromo.removeClass("plp-promo-active"),this.isIE8||a("html, body").animate({scrollTop:this.parentPromo.attr("data-scroll-back")},750);break;case"blp":this.parentPromo.closest(".blp-sizes").removeClass("blp-sizes-active")}},removeShelf:function(){"plp"===this.options.template&&this.shelf.remove()},openShelf:function(b){var c=b.closest(".content-slot").position().top+this.products.position().top+b.find(".promo-text").height();switch(b.attr("data-scroll-back",b.closest(".content-slot").position().top+this.products.position().top),this.options.template){case"plp":b.addClass("plp-promo-active"),this.shelf.css({top:c+90+"px"});break;case"blp":b.closest(".blp-sizes").addClass("blp-sizes-active")}this.shelf.css({"max-height":this.shelf.find(".promo-shelf").outerHeight()}).addClass("shelf-open"),this.isIE8||a("html, body").animate({scrollTop:this.shelf.offset().top-55},750)},hoverOverBottle:function(a){var b=a.position().left+a.width()/2;a.addClass("promo-shelf-bottle-active").siblings(".promo-shelf-bottle").addClass("promo-shelf-bottle-inactive"),this.setBgPos(b,a.width())},hoverOutBottle:function(a){var b=(this.bottles.eq(this.midElement),a.position().left+a.width()/2);a.removeClass("promo-shelf-bottle-active").siblings(".promo-shelf-bottle").removeClass("promo-shelf-bottle-inactive"),this.setBgPos(b,a.width()/2)},addListeners:function(){var b=this;this.bottles.hover(function(){b.hoverOverBottle(a(this))},function(){b.hoverOutBottle(a(this))}),this.parentPromo.on("click",function(c){c.preventDefault(),b.openShelf(a(this))}),this.shelf.find(".close-shelf").on("click",function(a){b.closeShelf()}),this.shelf.on("click",function(a){a.stopPropagation()})},init:function(){switch(this.isIE8?this.initBgPos.push(this.cnt.css("backgroundPositionX"),this.cnt.css("backgroundPositionY")):this.initBgPos=this.cnt.css("background-position").split(" "),this.bottles.append(a(this.flute).removeAttr("id")),this.parentPromo.addClass("plp-promo-shelf"),this.ele.wrap('<div class="shelf-container" />').append("<button class='close-shelf'>Close</button>"),this.shelf=this.ele.parent(),this.options.template){case"plp":this.shelf.insertAfter(this.products);break;case"blp":this.shelf.addClass("shelf-container-blp").insertAfter(this.parentPromo.closest(".blp-sizes"))}this.addListeners()}},a.fn.productShelf=function(c){return this.each(function(){a(this).data().productShelf=new b(a(this),c)})}}(jQuery);