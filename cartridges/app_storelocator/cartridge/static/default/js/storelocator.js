function LoadDetail(a){var b={url:a,type:"POST"};$.ajax(b).done(function(a){document.getElementById("map_location").innerHTML=a})}var StoreLocator={initialLocation:null,browserSupportFlag:new Boolean,distanceChecker:null,storeurl:null,lodgeurl:null,queryurl:null,cookieurl:null,cookiename:null,defaultlocation:null,zoomradius:{},markers:[],infowindows:[],radius:100,map:null,unit:"km",timer:null,maptype:null,serachrefineurl:null,findStore:null,searchparamvalue:null,defaultStoreVenueFilter:null,defaultZoom:null,init:function(a,b,c,d,e,f,g,h,j,k,l,m,n){this.zoomradius=a,this.storeurl=b,this.lodgeurl=c,this.queryurl=d,this.cookieurl=e,this.cookiename=f,this.defaultlocation=g,this.maptype=h,this.serachrefineurl=j,this.findStore=k,this.searchparamvalue=l,this.defaultStoreVenueFilter=m,this.defaultZoom=n;var o={zoom:14,mapTypeId:google.maps.MapTypeId[h]};map=new google.maps.Map(document.getElementById("map_canvas"),o),this.getGeoPosition(this.initialLocation),this.distanceChecker=this.initialLocation,google.maps.event.addListener(map,"center_changed",function(){var a=StoreLocator.getDistance(StoreLocator.distanceChecker,map.getCenter());a>StoreLocator.radius/2&&(StoreLocator.distanceChecker=map.getCenter(),window.clearTimeout(StoreLocator.timer),StoreLocator.timer=window.setTimeout(StoreLocator.calculateCurrentPosition,500))}),google.maps.event.addListener(map,"zoom_changed",function(){""==$("#distance").val()&&(StoreLocator.radius=StoreLocator.zoomradius[map.getZoom()],window.clearTimeout(StoreLocator.timer),StoreLocator.timer=window.setTimeout(StoreLocator.calculateCurrentPosition,500))}),$("#storeSearch").on("click",function(){if(""!=$("#searchParam").val().trim())StoreLocator.getSearchPosition();else{var a='<span id="error-msg" class="error">Please enter a valid city or postcode to find where you can enjoy Dom P&#233;rignon.</span>';if(StoreLocator.markers.length>0){for(i in StoreLocator.markers)"object"==typeof StoreLocator.markers[i]&&StoreLocator.markers[i].setMap(null);StoreLocator.markers.length=0}StoreLocator.closeInfoWindows(),StoreLocator.infowindows.length=0,$("#feature .error").remove(),$("#vertical-scrollbar-demo").html(""),$("#errorMsg").html(a).show(),$(".storeResults").css("visibility","hidden").animate({opacity:0}),$("#showHide").show(),$("#resultDiv").hide()}return!1}),$("#distance").change(function(){""!=$("#distance").val()?StoreLocator.radius=$("#distance").val():StoreLocator.radius=StoreLocator.zoomradius[map.getZoom()]}),$("#distanceunitpref").change(function(){StoreLocator.unit=$("#distanceunitpref").val(),StoreLocator.radius=""!=$("#distance").val()?$("#distance").val():StoreLocator.zoomradius[map.getZoom()]}),k&&($("#searchParam").val(l),$.getJSON(StoreLocator.serachrefineurl,{postalCode:$("#searchParam").val()},function(a){StoreLocator.populateStores(a.stores)}))},closeInfoWindows:function(){for(i in this.infowindows)"object"==typeof this.infowindows[i]&&this.infowindows[i].close()},populateStores:function(a){if(this.markers.length>0){for(i in this.markers)"object"==typeof this.markers[i]&&this.markers[i].setMap(null);this.markers.length=0}this.closeInfoWindows(),this.infowindows.length=0;this.lodgeurl;$("#vertical-scrollbar-demo").html("");var b,c=!1,d="";if(!isNaN($("#searchParam").val())){var e=$("#searchParam").val()+","+this.defaultlocation;this.geoCode(e,function(a,b){b==google.maps.GeocoderStatus.OK&&(d=a[0].geometry.location)})}for(var f in a){var g=this.getDistance(d,new google.maps.LatLng(a[f].latitude,a[f].longitude));a[f].distance=g}var h=[];$.each(a,function(a,b){h.push(b)}),h.length>0?(document.getElementById("resultDiv").style.display="block",document.getElementById("errorMsg").style.display="none",document.getElementById("NoresultDiv").style.display="none",document.getElementById("showHide").style.display="none",$(".storeResults").css("visibility","visible").animate({opacity:1})):(document.getElementById("resultDiv").style.display="none",document.getElementById("errorMsg").style.display="none",document.getElementById("NoresultDiv").style.display="block",$(".storeResults").css("visibility","hidden").animate({opacity:0}),document.getElementById("showHide").style.display="none");for(var i=0;i<h.length;i++){var j='<li class="store" id="'+h[i].ID+'">';c||(document.getElementById("resultCount").innerHTML=h.length,b=h[i],c=!0),j+='<h4 class="storename"><a href="javascript:void(0)">'+h[i].name+"</a></h4>",j+='<address class="address">'+h[i].address1+"<br/>",j+=h[i].city+", "+h[i].postalCode,j+="</address>",j+="<a class='detail' onClick='LoadDetail(\""+this.storeurl+h[i].ID+"\")'>Venue Details</a>",j+="</li>",$("#vertical-scrollbar-demo").append(j),$("#feature .error").remove(),marker=new google.maps.Marker({position:new google.maps.LatLng(h[i].latitude,h[i].longitude),map:map,title:h[i].name+" "+h[i].address1+" "+h[i].city,storeid:h[i].ID}),marker.setMap(map),0==i&&map.setCenter(new google.maps.LatLng(h[i].latitude,h[i].longitude)),this.markers.push(marker);var k='<div class="mapContent"><h1>'+h[i].name+'</h1><div class="contentBody"><p>'+h[i].address1+"</p><p>"+h[i].postalCode+", "+h[i].city+"</p><p>"+h[i].phone+"</p></div></div>";this.infowindows[h[i].ID+"Info"]=new google.maps.InfoWindow({content:k,position:marker.position}),google.maps.event.addListener(marker,"click",function(){StoreLocator.closeInfoWindows(),StoreLocator.infowindows[this.storeid+"Info"].open(map),$("#vertical-scrollbar-demo li.store").removeClass("selected"),$("#vertical-scrollbar-demo").find("#"+this.storeid).addClass("selected")}),$("#vertical-scrollbar-demo li a.detail").live("click",function(){$("#vertical-scrollbar-demo li.store").removeClass("selected"),$(this).parent().addClass("selected"),$(".map_canvas").addClass("hidden"),$(".map_location").removeClass("hidden")}),$("#vertical-scrollbar-demo li.store h4").live("click",function(){$("#vertical-scrollbar-demo li.store").removeClass("selected"),$(this).parent().addClass("selected");var a=$(this).parent().attr("id");StoreLocator.closeInfoWindows(),StoreLocator.infowindows[a+"Info"].open(map),$(".map_canvas").removeClass("hidden"),$(".map_location").addClass("hidden")}),$(".nano").nanoScroller()}var e;if(b)e=b.city+","+b.stateCode+","+b.countryCode;else{var j='<span id="error-msg" class="error">Sorry, we couldn`t find any results for your search.</span>';$("#feature .error").remove(),$("#feature").append(j),e=""==a?$("#searchParam").val()+","+b.countryCode:$("#searchParam").val()}this.geoCode(e,function(a,b){b==google.maps.GeocoderStatus.OK&&map.setZoom(14)})},showStoreDetails:function(){return $("#storedetails").load($(".storeDetails").attr("href"),function(){$("#storedetails").dialog({autoOpen:!1,width:900,height:660,modal:!0}),$("#storedetails").dialog("open")}),!1},getSearchPosition:function(){var a=document.getElementById("searchParam").value+" ";""!=$.trim(a)&&this.geoCode(a,function(b,c){c==google.maps.GeocoderStatus.OK&&StoreLocator.renderStores(a)})},geoCode:function(a,b){var c=new google.maps.Geocoder;c.geocode({address:a},function(a,c){b(a,c)})},renderStores:function(a){$.getJSON(StoreLocator.serachrefineurl,{postalCode:document.getElementById("searchParam").value},function(a){StoreLocator.populateStores(a.stores)})},reverseGeocode:function(a,b){var c=new google.maps.Geocoder;c.geocode({latLng:a},function(a,c){c==google.maps.GeocoderStatus.OK&&b(a)})},getGeoPosition:function(a){this.reverseGeocode(a,function(a){var b,c;for(var d in a)if(a[d].types&&("postal_code"==a[d].types[0]||"locality"==a[d].types[0]))for(var e in a[d].address_components){var f=a[d].address_components[e];f.types&&"postal_code"==f.types[0]?b=f.short_name:f.types&&"country"==f.types[0]&&(c=f.short_name)}"undefined"!=typeof b&&null!=b&&$.getJSON(this.queryurl,{postalCode:b},function(a){StoreLocator.populateStores(a.stores)})})},calculateCurrentPosition:function(){var a=map.getCenter();StoreLocator.getGeoPosition(a)},getDistance:function(a,b){if(!a||!b)return 0;var c=6371,d=(b.lat()-a.lat())*Math.PI/180,e=(b.lng()-a.lng())*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h},comparator:function(a,b){return a>b?1:b>a?-1:0}};$(document).ready(function(){$(".pt-storelocator").on("click touchstart",".closeThis",function(a){var b=$(this),c=b.parents(".storeResults"),d=c.find(".map_canvas"),e=b.parents(".map_location");e.addClass("hidden"),d.removeClass("hidden")}),$(".pt-storelocator").on("click touchstart","a.detail",function(){var a=$(this).siblings(".storename").text();$(".breadcrumb").find(".storeNameB").remove(),$(".breadcrumb").append("<li class='storeNameB'> "+a+"</li>")})});